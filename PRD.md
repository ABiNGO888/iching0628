# 周易卜卦应用产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品定位
"周易卜卦应用"是一款基于传统周易理论的现代化卜卦工具，结合AI技术为用户提供便捷、准确的卜卦体验和智能解读服务。

### 1.2 目标用户
- 对传统文化和周易感兴趣的用户
- 寻求人生指导和决策参考的用户
- 希望通过占卜获得心理慰藉的用户
- 学习和研究周易的爱好者

### 1.3 核心价值
- 传承传统周易文化
- 提供现代化的卜卦体验
- 结合AI技术提供个性化解读
- 支持多语言，面向全球用户

## 2. 功能需求

### 2.1 核心卜卦功能

#### 2.1.1 金钱卦 (硬币占卜)
**功能描述**: 传统的三枚硬币占卜方式

**详细流程**:
1. **默念问题阶段**
   - 显示引导界面，提示用户默念问题
   - 提供占卦前须知和注意事项
   - 支持跳过引导直接进入占卜

2. **摇卦过程**
   - 手动点击"摇卦"按钮，依次生成六爻
   - 三枚铜钱翻转动画效果
   - 支持点击屏幕任意位置快速跳过动画
   - 实时显示每一爻的结果（老阳、老阴、少阳、少阴）
   - 变爻（老阳、老阴）特殊标记

3. **卦象构建**
   - 从下往上逐步构建完整卦象
   - 实时显示卦象图形
   - 自动识别本卦和变卦

#### 2.1.2 数字卦 (数字占卜)
**功能描述**: 基于数字的现代占卜方式

**详细流程**:
1. **数字生成方式**
   - 随机生成：自动生成三个三位数
   - 手动输入：用户自行输入三个三位数
   - 数字滚动动画效果

2. **卦象转换**
   - 根据数字组合算法自动生成卦象
   - 支持变爻计算和显示
   - 自动生成对应的卦象解释

### 2.2 卦象解读功能

#### 2.2.1 传统解读
1. **卦象信息显示**
   - 卦象名称（如"乾为天"、"坤为地"）
   - 卦象编号和二进制表示
   - 卦辞完整内容
   - 现代白话解释

2. **变爻解析**
   - 变爻位置标记
   - 对应爻辞内容
   - 变卦信息（如有）
   - 根据易经规则选择正确的解读文本：
     - 无变爻或三个变爻：使用卦辞
     - 一个变爻：使用该爻的爻辞
     - 两个变爻：使用上爻的爻辞
     - 四个变爻：使用下面两个不变爻中的下爻爻辞
     - 五个变爻：使用唯一不变爻的爻辞
     - 六个变爻：使用变卦的卦辞

#### 2.2.2 AI智能解读
1. **AI文本解读**
   - 基于用户问题的个性化解读
   - 结合卦象和爻辞的智能分析
   - 支持多轮对话式解读
   - 使用阿里百炼通义千问API

2. **AI图像生成**
   - 基于卦象生成相关图像
   - 支持多种AI绘图服务
   - 可自定义提示词
   - 支持保存和分享生成的图像

### 2.3 用户系统

#### 2.3.1 身份认证
1. **多种登录方式**
   - 微信登录
   - QQ登录
   - 支付宝登录
   - 邮箱密码登录（备选）

2. **用户状态管理**
   - 免费用户：每日2次免费占卜
   - VIP会员：无限制使用
   - AI积分系统：新用户默认3次AI绘图机会

#### 2.3.2 会员系统
1. **免费用户权益**
   - 每日2次免费占卜功能
   - 基本卦象解读
   - 查看最近2次卦象记录
   - 使用时显示5秒广告
   - 无法保存历史记录
   - 无法使用高级解读功能

2. **VIP会员权益**
   - 无限次占卜使用
   - 详细卦象分析
   - 保存和查看所有历史记录
   - 无广告体验
   - AI智能解读功能
   - 高级图像生成
   - 优先客服支持
   - 月费：¥8.8

### 2.4 历史记录功能

#### 2.4.1 记录保存
- 占卜类型（金钱卦/数字卦）
- 本卦和变卦信息
- 变爻位置
- 用户问题
- 占卜时间
- AI解读结果（如有）

#### 2.4.2 记录管理
- 按时间排序查看
- 搜索和筛选功能
- 导出记录功能
- 删除记录功能

### 2.5 分享和保存功能

#### 2.5.1 结果分享
- 生成精美的卦象图片
- 包含卦象、解读和时间信息
- 支持分享到社交媒体
- 支持保存到相册

#### 2.5.2 内容导出
- 文本格式导出
- 图片格式保存
- PDF格式生成

### 2.6 AI设置和管理

#### 2.6.1 AI服务配置
- 支持多种AI服务提供商
- API密钥管理
- 自定义API端点
- 连接状态监控

#### 2.6.2 AI功能设置
- 自动生成开关
- 高质量模式
- 包含卦象图形
- 包含文本解读
- 自定义提示词模板

### 2.7 支付系统

#### 2.7.1 支付类型
- 会员订阅支付
- AI积分购买
- 一次性功能解锁

#### 2.7.2 支付流程
- 订单创建
- 支付网关集成（微信支付、支付宝）
- 支付状态跟踪
- 自动权益发放

### 2.8 多语言支持

#### 2.8.1 支持语言
- 简体中文
- 繁体中文
- 英语
- 日语
- 韩语

#### 2.8.2 本地化内容
- 界面文本翻译
- 卦象解释翻译
- 帮助文档翻译
- 错误信息翻译

## 3. 技术架构

### 3.1 前端技术栈
- **框架**: Next.js 15.2.4 (App Router)
- **UI组件**: shadcn/ui
- **样式**: Tailwind CSS
- **动画**: Framer Motion
- **状态管理**: React Hooks
- **国际化**: next-intl
- **类型检查**: TypeScript

### 3.2 后端技术栈
- **运行时**: Node.js
- **API框架**: Next.js API Routes
- **数据库**: SQLite (Prisma ORM)
- **身份认证**: NextAuth.js
- **文件存储**: 本地存储

### 3.3 第三方服务集成
- **AI服务**: 阿里百炼通义千问API
- **图像生成**: 支持多种AI绘图服务
- **支付服务**: 微信支付、支付宝
- **社交登录**: 微信、QQ、支付宝OAuth

### 3.4 数据模型

#### 3.4.1 用户模型 (User)
```typescript
interface User {
  id: string
  name?: string
  email?: string
  emailVerified?: Date
  image?: string
  password?: string
  role: string // 默认"user"
  subscriptionStatus: string // "free" | "premium"
  subscriptionExpires?: Date
  aiCreditsRemaining: number // 默认0
  createdAt: Date
  updatedAt: Date
}
```

#### 3.4.2 占卜历史模型 (DivinationHistory)
```typescript
interface DivinationHistory {
  id: string
  userId: string
  type: string // "coin" | "number"
  hexagram: string // 本卦
  resultHexagram?: string // 变卦
  changingLines?: string // 变爻
  question?: string // 问题
  createdAt: Date
}
```

#### 3.4.3 支付模型 (Payment)
```typescript
interface Payment {
  id: string
  userId: string
  amount: number
  currency: string // 默认"CNY"
  status: string // "pending" | "completed" | "failed"
  type: string // "subscription" | "ai_credits"
  orderId?: string
  createdAt: Date
}
```

## 4. 用户界面设计

### 4.1 设计风格
- **主色调**: 米色 (#f5eee1)
- **强调色**: 深棕色 (#8B4513)
- **字体**: 无衬线字体为主，标题使用古风字体
- **布局**: 简洁直观，避免过多装饰
- **响应式**: 支持移动端和桌面端

### 4.2 主要页面

#### 4.2.1 首页
- 应用标题和简介
- 卜卦方式选择（金钱卦/数字卦）
- 语言切换
- 会员升级入口
- 底部版权信息

#### 4.2.2 占卜页面
- 占卜前须知弹窗
- 占卜操作区域
- 动画效果展示
- 卦象构建区域
- 结果展示区域
- AI解读功能

#### 4.2.3 结果页面
- 卦象图形展示
- 卦象名称和时间
- 详细解读内容
- 变卦信息（如有）
- 操作按钮（保存、分享、重新占卜）

#### 4.2.4 会员页面
- 会员方案对比
- 权益说明
- 支付入口
- 当前状态显示

#### 4.2.5 设置页面
- AI服务配置
- 个人信息管理
- 历史记录查看
- 语言设置

## 5. 业务流程

### 5.1 用户注册流程
1. 选择登录方式（微信/QQ/支付宝/邮箱）
2. 完成OAuth授权或邮箱验证
3. 创建用户账户
4. 分配免费额度
5. 引导用户完成首次占卜

### 5.2 占卜流程
1. 用户选择占卜方式
2. 阅读占卜须知
3. 默念问题
4. 执行占卜操作
5. 生成卦象结果
6. 查看传统解读
7. 可选AI智能解读
8. 保存或分享结果

### 5.3 会员升级流程
1. 查看会员权益对比
2. 选择会员方案
3. 创建支付订单
4. 完成支付
5. 自动开通会员权限
6. 发送确认通知

### 5.4 AI解读流程
1. 检查用户权限和积分
2. 输入具体问题
3. 准备卦象和爻辞数据
4. 调用AI API
5. 处理和展示结果
6. 扣除相应积分
7. 保存解读记录

## 6. 性能要求

### 6.1 响应时间
- 页面加载时间 < 3秒
- 占卜动画流畅度 > 30fps
- AI解读响应时间 < 10秒
- 数据库查询响应 < 1秒

### 6.2 并发处理
- 支持100+并发用户
- 数据库连接池管理
- API限流保护
- 缓存策略优化

### 6.3 可用性
- 系统可用性 > 99%
- 错误处理和降级策略
- 数据备份和恢复
- 监控和告警机制

## 7. 安全要求

### 7.1 数据安全
- 用户密码加密存储
- API密钥安全管理
- 敏感数据传输加密
- 定期安全审计

### 7.2 访问控制
- 基于角色的权限管理
- API访问频率限制
- 防止SQL注入和XSS攻击
- CSRF保护

### 7.3 隐私保护
- 用户数据最小化收集
- 数据使用透明化
- 支持数据删除请求
- 遵循相关隐私法规

## 8. 运营策略

### 8.1 用户获取
- 社交媒体推广
- 内容营销
- 口碑传播
- 合作推广

### 8.2 用户留存
- 每日签到奖励
- 个性化推荐
- 社区功能
- 定期活动

### 8.3 变现模式
- 会员订阅收费
- AI功能按次付费
- 高级功能解锁
- 广告收入（免费用户）

## 9. 发展规划

### 9.1 短期目标（1-3个月）
- 完善核心占卜功能
- 优化用户体验
- 增加更多AI服务支持
- 扩展支付方式

### 9.2 中期目标（3-6个月）
- 增加社区功能
- 开发移动端APP
- 增加更多占卜方式
- 国际化扩展

### 9.3 长期目标（6-12个月）
- 构建用户生态
- 开发周易学习功能
- 增加专家咨询服务
- 探索AR/VR占卜体验

## 10. 风险评估

### 10.1 技术风险
- AI服务稳定性
- 第三方API依赖
- 数据库性能瓶颈
- 安全漏洞风险

### 10.2 业务风险
- 市场竞争加剧
- 用户需求变化
- 政策法规变化
- 运营成本上升

### 10.3 应对策略
- 多服务商备选方案
- 持续技术优化
- 用户反馈收集
- 合规性审查

---

**文档版本**: v1.0  
**创建日期**: 2024年1月  
**最后更新**: 2024年1月  
**负责人**: 产品团队